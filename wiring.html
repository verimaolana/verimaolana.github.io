<!doctype html>

<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wiring Photo Editor — Zoom + Smart Drag</title>
<style>
body{font-family:system-ui;margin:20px;background:#f4f6fb}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
.container{position:relative;display:inline-block;border:1px solid #ccc;background:#fff;overflow:hidden}
.canvasWrap{position:relative;transform-origin:0 0}
canvas{display:block}
.palette{display:flex;gap:5px}
.swatch{width:24px;height:24px;border-radius:4px;cursor:pointer;border:2px solid #fff;box-shadow:0 0 0 1px rgba(0,0,0,.1) inset}
.swatch.selected{outline:2px solid #000}
input[type=range]{width:120px}
.hint{font-size:13px;color:#555;margin-top:8px}
</style>
</head>
<body><h3>Wiring Editor (Orthogonal + Zoom)</h3><div class="controls">
<label>Image <input id="imgInput" type="file" accept="image/*"></label><div>Color:
<div class="palette" id="palette"></div>
<input type="color" id="colorPicker">
</div><div>Thickness:
<input type="range" id="thickness" min="2" max="30" value="6">
<span id="thicknessVal">6</span>px
</div><button id="clearBtn">Clear</button> <button id="downloadBtn">Download PNG</button> <span>Zoom: <span id="zoomVal">100%</span></span>

</div><div class="container" id="canvasContainer" style="display:none">
<div class="canvasWrap" id="canvasWrap">
<canvas id="imageCanvas"></canvas>
<canvas id="overlayCanvas" style="position:absolute;left:0;top:0"></canvas>
</div>
</div><div class="hint">
CTRL + = Zoom In | CTRL + - = Zoom Out
Drag mouse → garis selalu mengikuti posisi terakhir mouse ditahan.
</div><script>
const imgInput=document.getElementById('imgInput');
const imageCanvas=document.getElementById('imageCanvas');
const overlayCanvas=document.getElementById('overlayCanvas');
const container=document.getElementById('canvasContainer');
const wrap=document.getElementById('canvasWrap');
const colorPicker=document.getElementById('colorPicker');
const paletteEl=document.getElementById('palette');
const thicknessSlider=document.getElementById('thickness');
const thicknessVal=document.getElementById('thicknessVal');
const clearBtn=document.getElementById('clearBtn');
const downloadBtn=document.getElementById('downloadBtn');
const zoomVal=document.getElementById('zoomVal');

const imageCtx=imageCanvas.getContext('2d');
const overlayCtx=overlayCanvas.getContext('2d');

let lines=[];
let drawing=false;
let start={x:0,y:0};
let currentColor='#ff0000';
let currentThickness=6;
let zoom=1;

function updateZoom(){
wrap.style.transform=`scale(${zoom})`;
zoomVal.textContent=Math.round(zoom*100)+'%';
}

window.addEventListener('keydown',e=>{
if(e.ctrlKey && (e.key==='='||e.key==='+')){e.preventDefault();zoom+=0.1;updateZoom();}
if(e.ctrlKey && e.key==='-'){e.preventDefault();zoom=Math.max(0.2,zoom-0.1);updateZoom();}
if(e.key==='z'&&lines.length){lines.pop();redraw();}
});

thicknessSlider.oninput=e=>{
currentThickness=parseInt(e.target.value);
thicknessVal.textContent=currentThickness;
}

const preset=['#ff0000','#00cc00','#0044ff','#ffaa00','#ffffff','#000000'];
preset.forEach(c=>{
const d=document.createElement('div');
d.className='swatch';
d.style.background=c;
d.onclick=()=>{currentColor=c;colorPicker.value=c;selectSwatch(d)};
paletteEl.appendChild(d);
});

function selectSwatch(sel){
document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('selected'));
if(sel) sel.classList.add('selected');
}

colorPicker.oninput=e=>{currentColor=e.target.value;selectSwatch(null)};

imgInput.onchange=e=>{
const f=e.target.files[0];
if(!f)return;
const url=URL.createObjectURL(f);
const img=new Image();
img.onload=()=>{
imageCanvas.width=overlayCanvas.width=img.naturalWidth;
imageCanvas.height=overlayCanvas.height=img.naturalHeight;
imageCtx.drawImage(img,0,0);
container.style.display='inline-block';
lines=[];redraw();
URL.revokeObjectURL(url);
}
img.src=url;
}

function getPos(evt){
const rect=overlayCanvas.getBoundingClientRect();
const x=(evt.clientX-rect.left)/zoom;
const y=(evt.clientY-rect.top)/zoom;
return{x:Math.round(x),y:Math.round(y)};
}

overlayCanvas.onmousedown=e=>{drawing=true;start=getPos(e)};
overlayCanvas.onmousemove=e=>{
if(!drawing)return;
preview(getPos(e));
}
window.onmouseup=e=>{
if(!drawing)return;
drawing=false;
const end=getPos(e);
const fixed=orthogonal(start,end);
lines.push({x1:start.x,y1:start.y,x2:fixed.x,y2:fixed.y,color:currentColor,thickness:currentThickness});
redraw();
}

function orthogonal(a,b){
const dx=Math.abs(b.x-a.x);
const dy=Math.abs(b.y-a.y);
return dx>dy?{x:b.x,y:a.y}:{x:a.x,y:b.y};
}

function preview(pos){
redraw();
const fixed=orthogonal(start,pos);
drawLine(start.x,start.y,fixed.x,fixed.y,currentColor,currentThickness);
}

function drawLine(x1,y1,x2,y2,color,t){
overlayCtx.lineWidth=t;
overlayCtx.lineCap='round';
overlayCtx.strokeStyle=color;
overlayCtx.beginPath();
overlayCtx.moveTo(x1,y1);
overlayCtx.lineTo(x2,y2);
overlayCtx.stroke();
}

function redraw(){
overlayCtx.clearRect(0,0,overlayCanvas.width,overlayCanvas.height);
lines.forEach(l=>drawLine(l.x1,l.y1,l.x2,l.y2,l.color,l.thickness));
}

clearBtn.onclick=()=>{if(confirm('Clear all?')){lines=[];redraw();}};

downloadBtn.onclick=()=>{
const merged=document.createElement('canvas');
merged.width=imageCanvas.width;
merged.height=imageCanvas.height;
const ctx=merged.getContext('2d');
ctx.drawImage(imageCanvas,0,0);
ctx.drawImage(overlayCanvas,0,0);
const a=document.createElement('a');
a.href=merged.toDataURL('image/png');
a.download='wiring-export.png';
a.click();
}
</script></body>
</html>
